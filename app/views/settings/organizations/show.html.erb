<div class="min-h-screen bg-slate-50">
  <%= render 'shared/header' %>

  <div class="max-w-4xl mx-auto px-6 py-8">
    <!-- Settings Navigation -->
    <div class="flex gap-4 mb-8 border-b border-slate-200 pb-4">
      <%= link_to settings_notifications_path, class: "px-4 py-2 rounded-lg font-medium #{controller.controller_name == 'notifications' ? 'bg-emerald-100 text-emerald-700' : 'text-slate-600 hover:bg-slate-100'}" do %>
        Notifications
      <% end %>
      <% if current_user.admin? %>
        <%= link_to settings_organization_path, class: "px-4 py-2 rounded-lg font-medium #{controller.controller_name == 'organizations' ? 'bg-emerald-100 text-emerald-700' : 'text-slate-600 hover:bg-slate-100'}" do %>
          Organization
        <% end %>
      <% end %>
      <% if current_user.owner? %>
        <%= link_to settings_billing_path, class: "px-4 py-2 rounded-lg font-medium #{controller.controller_name == 'billings' ? 'bg-emerald-100 text-emerald-700' : 'text-slate-600 hover:bg-slate-100'}" do %>
          Billing
        <% end %>
      <% end %>
    </div>

    <h1 class="text-2xl font-bold text-slate-900 mb-6">Organization Settings</h1>

    <%= form_with model: @organization, url: settings_organization_path, method: :patch, class: 'space-y-6' do |f| %>
      <div class="bg-white rounded-2xl border border-slate-200 p-6">
        <h3 class="font-semibold text-slate-900 mb-4">Practice Information</h3>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Practice Name</label>
            <%= f.text_field :name, class: 'w-full max-w-md px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500' %>
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Industry</label>
            <%= f.select :industry, [['Medical Practice', 'medical'], ['Dental Office', 'dental'], ['Law Firm', 'legal'], ['Other', 'other']], {}, class: 'w-full max-w-md px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-emerald-500' %>
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Timezone</label>
            <%= f.time_zone_select :timezone, nil, { default: 'Eastern Time (US & Canada)' }, class: 'w-full max-w-md px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-emerald-500' %>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-2xl border border-slate-200 p-6">
        <h3 class="font-semibold text-slate-900 mb-2">Compliance Health Score</h3>
        <p class="text-sm text-slate-500 mb-4">Current score based on document expiration status</p>
        
        <div class="flex items-center gap-4">
          <div class="relative w-20 h-20">
            <svg class="w-20 h-20 transform -rotate-90">
              <circle cx="40" cy="40" r="32" stroke="#E2E8F0" stroke-width="8" fill="none"/>
              <circle cx="40" cy="40" r="32" 
                stroke="<%= (@organization.compliance_health_score || 100) >= 80 ? '#10B981' : (@organization.compliance_health_score || 100) >= 50 ? '#F59E0B' : '#EF4444' %>" 
                stroke-width="8" fill="none"
                stroke-dasharray="201"
                stroke-dashoffset="<%= 201 * (1 - (@organization.compliance_health_score || 100) / 100.0) %>"
                stroke-linecap="round"/>
            </svg>
            <span class="absolute inset-0 flex items-center justify-center text-xl font-bold text-slate-900">
              <%= @organization.compliance_health_score || 100 %>
            </span>
          </div>
          <div>
            <p class="font-medium text-slate-900">
              <%= (@organization.compliance_health_score || 100) >= 80 ? 'Good Standing' : (@organization.compliance_health_score || 100) >= 50 ? 'Needs Attention' : 'Action Required' %>
            </p>
            <p class="text-sm text-slate-500">
              <%= @organization.documents.count %> total documents Â· 
              <%= @organization.documents.expired.count %> expired
            </p>
          </div>
        </div>
      </div>

      <div class="flex justify-end">
        <%= f.submit 'Save Changes', class: 'px-6 py-3 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg font-semibold transition-colors cursor-pointer' %>
      </div>
    <% end %>
  </div>
</div>
