<div class="min-h-screen bg-slate-50">
  <%= render 'shared/header' %>

  <div class="max-w-4xl mx-auto px-6 py-8">
    <!-- Settings Navigation -->
    <div class="flex gap-4 mb-8 border-b border-slate-200 pb-4">
      <%= link_to settings_notifications_path, class: "px-4 py-2 rounded-lg font-medium #{controller.controller_name == 'notifications' ? 'bg-emerald-100 text-emerald-700' : 'text-slate-600 hover:bg-slate-100'}" do %>
        Notifications
      <% end %>
      <% if current_user.admin? %>
        <%= link_to settings_organization_path, class: "px-4 py-2 rounded-lg font-medium #{controller.controller_name == 'organizations' ? 'bg-emerald-100 text-emerald-700' : 'text-slate-600 hover:bg-slate-100'}" do %>
          Organization
        <% end %>
      <% end %>
      <% if current_user.owner? %>
        <%= link_to settings_billing_path, class: "px-4 py-2 rounded-lg font-medium #{controller.controller_name == 'billings' ? 'bg-emerald-100 text-emerald-700' : 'text-slate-600 hover:bg-slate-100'}" do %>
          Billing
        <% end %>
      <% end %>
    </div>

    <h1 class="text-2xl font-bold text-slate-900 mb-6">Notification Settings</h1>

    <%= form_with model: @notification_setting, url: settings_notifications_path, method: :patch, class: 'space-y-8' do |f| %>
      <!-- Email Notifications -->
      <div class="bg-white rounded-2xl border border-slate-200 p-6">
        <div class="flex items-start justify-between">
          <div>
            <h3 class="font-semibold text-slate-900 flex items-center gap-2">
              <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
              Email Notifications
            </h3>
            <p class="text-sm text-slate-500 mt-1">Receive expiration reminders and weekly digests via email</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <%= f.check_box :email_enabled, class: 'sr-only peer' %>
            <div class="w-11 h-6 bg-slate-200 peer-focus:ring-4 peer-focus:ring-emerald-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div>
          </label>
        </div>
      </div>

      <!-- SMS Notifications -->
      <div class="bg-white rounded-2xl border border-slate-200 p-6">
        <div class="flex items-start justify-between mb-4">
          <div>
            <h3 class="font-semibold text-slate-900 flex items-center gap-2">
              <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
              SMS Notifications
            </h3>
            <p class="text-sm text-slate-500 mt-1">Get urgent reminders via text message (requires Twilio setup)</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <%= f.check_box :sms_enabled, class: 'sr-only peer' %>
            <div class="w-11 h-6 bg-slate-200 peer-focus:ring-4 peer-focus:ring-emerald-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div>
          </label>
        </div>
        <div class="pt-4 border-t border-slate-100">
          <label class="block text-sm font-medium text-slate-700 mb-1">Twilio Phone Number</label>
          <%= f.text_field :twilio_phone_number, class: 'w-full max-w-xs px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-emerald-500', placeholder: '+1234567890' %>
        </div>
      </div>

      <!-- Slack Notifications -->
      <div class="bg-white rounded-2xl border border-slate-200 p-6">
        <div class="flex items-start justify-between mb-4">
          <div>
            <h3 class="font-semibold text-slate-900 flex items-center gap-2">
              <svg class="w-5 h-5 text-slate-500" fill="currentColor" viewBox="0 0 24 24"><path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.687 8.834a2.528 2.528 0 0 1-2.521 2.521 2.527 2.527 0 0 1-2.521-2.521V2.522A2.527 2.527 0 0 1 15.166 0a2.528 2.528 0 0 1 2.521 2.522v6.312zM15.166 18.956a2.528 2.528 0 0 1 2.521 2.522A2.528 2.528 0 0 1 15.166 24a2.527 2.527 0 0 1-2.521-2.522v-2.522h2.521zM15.166 17.687a2.527 2.527 0 0 1-2.521-2.521 2.528 2.528 0 0 1 2.521-2.521h6.312A2.528 2.528 0 0 1 24 15.166a2.528 2.528 0 0 1-2.522 2.521h-6.312z"/></svg>
              Slack Notifications
            </h3>
            <p class="text-sm text-slate-500 mt-1">Post reminders to your Slack channel</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <%= f.check_box :slack_enabled, class: 'sr-only peer' %>
            <div class="w-11 h-6 bg-slate-200 peer-focus:ring-4 peer-focus:ring-emerald-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div>
          </label>
        </div>
        <div class="pt-4 border-t border-slate-100">
          <label class="block text-sm font-medium text-slate-700 mb-1">Slack Webhook URL</label>
          <%= f.text_field :slack_webhook_url, class: 'w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-emerald-500', placeholder: 'https://hooks.slack.com/services/...' %>
          <p class="text-xs text-slate-500 mt-1">Create an incoming webhook in your Slack workspace settings</p>
        </div>
      </div>

      <!-- Reminder Intervals -->
      <div class="bg-white rounded-2xl border border-slate-200 p-6">
        <h3 class="font-semibold text-slate-900 mb-2">Reminder Schedule</h3>
        <p class="text-sm text-slate-500 mb-4">Choose when to send reminders before document expiration</p>
        <div class="flex flex-wrap gap-3">
          <% [90, 60, 30, 14, 7, 3, 1].each do |days| %>
            <label class="flex items-center gap-2 px-4 py-2 border rounded-lg cursor-pointer hover:bg-slate-50 has-[:checked]:bg-emerald-50 has-[:checked]:border-emerald-300">
              <%= check_box_tag 'notification_setting[reminder_intervals][]', days, @notification_setting.reminder_intervals&.include?(days), class: 'w-4 h-4 text-emerald-600 rounded focus:ring-emerald-500' %>
              <span class="text-sm font-medium text-slate-700"><%= days %> days</span>
            </label>
          <% end %>
        </div>
      </div>

      <!-- Escalation -->
      <div class="bg-white rounded-2xl border border-slate-200 p-6">
        <div class="flex items-start justify-between mb-4">
          <div>
            <h3 class="font-semibold text-slate-900">Escalation</h3>
            <p class="text-sm text-slate-500 mt-1">Escalate unacknowledged reminders to admins and owners</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <%= f.check_box :escalation_enabled, class: 'sr-only peer' %>
            <div class="w-11 h-6 bg-slate-200 peer-focus:ring-4 peer-focus:ring-emerald-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div>
          </label>
        </div>
        <div class="flex items-center gap-3">
          <label class="text-sm text-slate-700">Escalate after</label>
          <%= f.number_field :escalation_after_days, min: 1, max: 30, class: 'w-20 px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-emerald-500 text-center' %>
          <span class="text-sm text-slate-700">days without acknowledgment</span>
        </div>
      </div>

      <div class="flex justify-end">
        <%= f.submit 'Save Settings', class: 'px-6 py-3 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg font-semibold transition-colors cursor-pointer' %>
      </div>
    <% end %>
  </div>
</div>
